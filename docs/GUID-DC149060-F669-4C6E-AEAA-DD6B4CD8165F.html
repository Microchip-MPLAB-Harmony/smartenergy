<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us" data-whc_version="24.1">
    <head><link rel="shortcut icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><link rel="icon" href="oxygen-webhelp\template\resources/images/favicon.ico"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="description" content="The RF215 library builds on top of an SPI peripheral library (PLIB) to communicate with the RF215 transceiver, which implements 802.15.4 SUN PHY layeres. However, the underlying use of the SPI port is ..."/><meta name="copyright" content="(C) Copyright 2023"/><meta name="generator" content="DITA-OT"/><title>1.1.4.2 Using The Library</title><!--  Generated with Oxygen version 24.1, build number 2022062014.  --><meta name="wh-path2root" content=""/><meta name="wh-toc-id" content="&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;?workdir /D:\InfoShare\Data\Publish\Data\k23pamdhcxd\work\temp?&gt;&lt;?workdir-uri file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/temp/?&gt;&lt;?path2project?&gt;&lt;?path2project-uri ./?&gt;&lt;?path2rootmap-uri ./?&gt;&lt;topic xmlns:dita-ot=&#34;http://dita-ot.sourceforge.net/ns/201007/dita-ot&#34; xmlns:ditaarch=&#34;http://dita.oasis-open.org/architecture/2005/&#34; class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; id=&#34;using-the-library&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;topic:1;184:15&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;title:1;184:15&#34;&gt;Using The Library&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;body:1;184:15&#34;&gt;&lt;p class=&#34;- topic/p &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;p:1;184:15&#34;&gt;The RF215 library builds on top of an SPI peripheral library (PLIB) to communicate with the RF215 transceiver, which implements 802.15.4 SUN PHY layeres. However, the underlying use of the SPI port is abstracted to the user, and library provides a modem-like interface with data transmission and reception functions and configuration parameters that can be read/written.&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;p:2;184:15&#34;&gt;Data service access is done in asynchronous mode, requiring some callbacks to be set in order to let the library to provide communication events to the user.&lt;/p&gt;&lt;p class=&#34;- topic/p &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;p:3;184:15&#34;&gt;Management service access is done in synchronous mode, and the get/set functions provide the results as part of the returned/referenced parameters.&lt;/p&gt;&lt;/body&gt;&lt;related-links class=&#34;- topic/related-links &#34;&gt;&lt;linkpool class=&#34;- topic/linkpool &#34; mapkeyref=&#34;GUID-F454DB36-5AD7-4DBC-882C-6FC64DF4ADB2&#34; xtrc=&#34;topicref:3;6:402&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-8F14109F-51A2-4E4F-8682-E5D5D3A2D6BC.ditamap&#34;&gt;&lt;link class=&#34;- topic/link &#34; format=&#34;dita&#34; href=&#34;GUID-2EE5EBF2-6C99-4D66-9EEC-A0C3C8CD40EF.md&#34; mapclass=&#34;- map/topicref &#34; role=&#34;parent&#34; scope=&#34;local&#34; type=&#34;topic&#34; xtrc=&#34;topicref:1;6:99&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-8F14109F-51A2-4E4F-8682-E5D5D3A2D6BC.ditamap&#34;&gt;&lt;?ditaot usertext?&gt;&lt;linktext class=&#34;- topic/linktext &#34;&gt;&lt;?ditaot gentext?&gt;RF215 Driver&lt;/linktext&gt;&lt;/link&gt;&lt;/linkpool&gt;&lt;/related-links&gt;&lt;topic class=&#34;- topic/topic &#34; ditaarch:DITAArchVersion=&#34;2.0&#34; specializations=&#34;@props/audience @props/deliveryTarget @props/otherprops @props/platform @props/product&#34; id=&#34;example-application-to-send-data-through-rf-and-wait-for-a-response&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;topic:2;184:15&#34; domains=&#34;a(props audience) a(props deliveryTarget) a(props otherprops) a(props platform) a(props product)&#34;&gt;&lt;title class=&#34;- topic/title &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;title:2;184:15&#34;&gt;Example application to send data through RF and wait for a response&lt;/title&gt;&lt;body class=&#34;- topic/body &#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;body:2;184:15&#34;&gt;&lt;codeblock class=&#34;+ topic/pre pr-d/codeblock &#34; xml:space=&#34;preserve&#34; outputclass=&#34;c&#34; xtrf=&#34;file:/D:/InfoShare/Data/Publish/Data/k23pamdhcxd/work/2/en-US/GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md&#34; xtrc=&#34;codeblock:1;184:15&#34;&gt;#include &#34;app.h&#34; #include &#34;driver/rf215/drv_rf215.h&#34; #define APP_TIME_BTW_MSG_US 5000 typedef enum { /* Application's state machine's initial state. */ APP_STATE_INIT=0, APP_STATE_RUNNING, APP_PLC_STATE_ERROR, } APP_STATES; DRV_RF215_TX_REQUEST_OBJ txReqObj; DRV_HANDLE rf215Handle; DRV_RF215_TX_HANDLE rfTxHandle; APP_STATES appState; uint32_t txTotalCount, txOkCount, rxOkCount, rxBadFcsCount uint8_t psduTx[DRV_RF215_MAX_PSDU_LEN]; static void APP_UpdateTxData() { /* Update TX data content */ uint16_t dataLen = txReqObj.psduLen - DRV_RF215_FCS_LEN; for (uint16_t k = 0; k &amp;lt; dataLen; k++) { psduTx[k] = (uint8_t) (k + dataLen); } } static void APP_TxCfmHandler ( DRV_RF215_TX_HANDLE txHandle, DRV_RF215_TX_CONFIRM_OBJ *cfmObj, uintptr_t context) { if (txHandle != rfTxHandle) { return; } txTotalCount++; if (cfmObj-&amp;gt;txResult == RF215_TX_SUCCESS) { txOkCount++; } if (txReqObj.psduLen &amp;lt; DRV_RF215_MAX_PSDU_LEN) { txReqObj.psduLen++; } else { txReqObj.psduLen = DRV_RF215_FCS_LEN + 1; } /* Update TX data */ APP_UpdateTxData(); } static void APP_RxIndHandler(DRV_RF215_RX_INDICATION_OBJ* ind, uintptr_t ctxt) { if (ind-&amp;gt;fcsOk == true) { DRV_RF215_TX_RESULT txResult; /* Update TX time and send new TX request */ txReqObj.time = ind-&amp;gt;timeIni + SYS_TIME_USToCount(ind-&amp;gt;ppduDurationUS + APP_TIME_BTW_MSG_US); rfTxHandle = DRV_RF215_TxRequest(rf215Handle, &amp;amp;txReqObj, &amp;amp;txResult); rxOkCount++; } else { rxBadFcsCount++; } } void APP_PLC_Initialize ( void ) { /* Place the App state machine in its initial state. */ appState = APP_STATE_INIT; rf215Handle = DRV_HANDLE_INVALID; /* Initialize TX request object */ txReqObj.cancelByRx = false; txReqObj.ccaMode = PHY_CCA_MODE_3; txReqObj.modScheme = FSK_FEC_OFF; txReqObj.txPwrAtt = 0; txReqObj.psduLen = DRV_RF215_FCS_LEN + 1; txReqObj.timeMode = TX_TIME_ABSOLUTE; txReqObj.time = SYS_TIME_Counter64Get() + SYS_TIME_MSToCount(10); txReqObj.psdu = psduTx; APP_UpdateTxData(); } void APP_PLC_Tasks ( void ) { /* Check the application's current state. */ switch ( appState ) { /* Application's initial state. */ case APP_STATE_INIT: { SYS_STATUS rf215Status = DRV_RF215_Status(sysObj.drvRf215); if (rf215Status == SYS_STATUS_READY) { rf215Handle = DRV_RF215_Open(DRV_RF215_INDEX_0, RF215_TRX_ID_RF09); if (rf215Handle != DRV_HANDLE_INVALID) { DRV_RF215_TX_RESULT txResult; DRV_RF215_RxIndCallbackRegister(rf215Handle, APP_RxIndHandler, 0); DRV_RF215_TxCfmCallbackRegister(rf215Handle, APP_TxCfmHandler, 0); rfTxHandle = DRV_RF215_TxRequest(rf215Handle, &amp;amp;txReqObj, &amp;amp;txResult); appState = APP_STATE_RUNNING; } } else if (rf215Status == SYS_STATUS_ERROR) { appState = APP_STATE_ERROR; } break; } case APP_STATE_RUNNING: { break; } default: { /* TODO: Handle error in application's state machine. */ break; } } } &lt;/codeblock&gt;&lt;/body&gt;&lt;/topic&gt;&lt;/topic&gt;"/><meta name="wh-source-relpath" content="GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.md"/><meta name="wh-out-relpath" content="GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.html"/>
    <!-- Latest compiled and minified Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/lib/bootstrap/css/bootstrap.min.css"/>
    
    <link rel="stylesheet" href="./oxygen-webhelp/lib/jquery-ui/jquery-ui.min.css"/>
    
    <!-- Template default styles  -->
    <link rel="stylesheet" type="text/css" href="./oxygen-webhelp/app/topic-page.css?buildId=2022062014"/>
    
    
    <script src="./oxygen-webhelp/lib/jquery/jquery-3.5.1.min.js"></script>
    
    <script data-main="./oxygen-webhelp/app/topic-page.js" src="./oxygen-webhelp/lib/requirejs/require.js"></script>
<link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/microchip.css?buildId=2022062014"/><link rel="stylesheet" type="text/css" href="oxygen-webhelp/template/notes.css?buildId=2022062014"/>
<script src="mchp-context-help.js"></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async="" type="text/javascript"></script>
</head>

    <body id="using-the-library" class="wh_topic_page frmBody">
        <a href="#wh_topic_body" class="sr-only sr-only-focusable">
            Jump to main content
        </a>
        
        
        
        
        <header class="navbar navbar-default wh_header">
    <div class="container-fluid">
        <div class="wh_header_flex_container navbar-nav navbar-expand-md navbar-dark">
            <div class="wh_logo_and_publication_title_container">
                <div class="wh_logo_and_publication_title">
                    
                    <a href="index.html" class=" wh_logo d-none d-sm-block "><img src="oxygen-webhelp\template\resources/images/microchip.png" alt="MPLAB Harmony Smart Energy Library "/></a>
                    <div class=" wh_publication_title "><a href="index.html">MPLAB Harmony Smart Energy Library </a></div>
                    
                </div>
                
                
            </div>

            <div class="wh_top_menu_and_indexterms_link collapse navbar-collapse" id="wh_top_menu_and_indexterms_link">
                
                
                
                
            </div>
        </div>
    </div>
</header>
        
        
         
        
        <div class=" wh_search_input navbar-form wh_topic_page_search search " role="form">
            
            
            
            <form id="searchForm" method="get" role="search" action="search.html"><div class="d-flex justify-contents-around"><div class="flex-grow-1"></div><div class="position-relative flex-grow-1"><input type="search" placeholder="Search " class="wh_search_textfield" id="textToSearch" name="searchQuery" aria-label="Search query" required="required"/><button type="submit" class="wh_search_button" aria-label="Search"><span class="search_input_text">Search</span></button></div><div class="align-self-center flex-grow-1 ml-2"></div></div></form>
            
            <div class="mchp-color-stripe-grid-container">
  <div class="mchp-main-bar mchp-orange-bar"></div>
  <div class="mchp-main-bar mchp-blue-bar"></div>
  <div class="mchp-main-bar mchp-green-bar"></div>
</div>
            
        </div>
        
        <div class="container-fluid" id="wh_topic_container">
            <div class="row">

                <nav class="wh_tools d-print-none navbar-expand-md" aria-label="Tools">
                    
                    <div data-tooltip-position="bottom" class=" wh_breadcrumb "><ol class="d-print-none"><li><span class="home"><a href="index.html"><span>Home</span></a></span></li><li><div class="topicref" data-id="mplab-harmony-smart-energy-library"><div class="title"><a href="GUID-81A73CB2-02C0-41CF-9C28-0AECE56FFF26.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
MPLAB® Harmony Smart Energy Library</a></div></div></li><li><div class="topicref" data-id="driver-libraries"><div class="title"><a href="GUID-97853572-2DF9-4BDC-8CC2-427931EE96D9.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1</ph>
Driver Libraries</a></div></div></li><li><div class="topicref" data-id="rf215-driver"><div class="title"><a href="GUID-2EE5EBF2-6C99-4D66-9EEC-A0C3C8CD40EF.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4</ph>
RF215 Driver</a></div></div></li><li class="active"><div class="topicref" data-id="using-the-library"><div class="title"><a href="GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.html"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4.2</ph>
Using The Library</a></div></div></li></ol></div>
                    
                    
                    
                    <div class="wh_right_tools">
                        <button class="wh_hide_highlight" aria-label="Toggle search highlights" title="Toggle search highlights"></button>
                        <button class="webhelp_expand_collapse_sections" data-next-state="collapsed" aria-label="Collapse sections" title="Collapse sections"></button>
                        
                        
                        
                        
                        <div class=" wh_print_link print d-none d-md-inline-block "><button onClick="window.print()" title="Print this page" aria-label="Print this page"></button></div>
                        
                        <button type="button" id="wh_toc_button" class="custom-toggler navbar-toggler collapsed wh_toggle_button navbar-light" aria-expanded="false" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                    </div>
                    
                </nav>
            </div>
            
            
            
            
            <div class="wh_content_area">
                <div class="row">
                    
                        <nav id="wh_publication_toc" class="col-lg-3 col-md-3 col-sm-12 d-md-block d-none d-print-none" aria-label="Table of Contents Container">
                            <div id="wh_publication_toc_content">
		                        
                            	<div class=" wh_publication_toc " data-tooltip-position="right"><span class="expand-button-action-labels"><span id="button-expand-action" role="button" aria-label="Expand"></span><span id="button-collapse-action" role="button" aria-label="Collapse"></span><span id="button-pending-action" role="button" aria-label="Pending"></span></span><ul role="tree" aria-label="Table of Contents"><li role="treeitem" aria-expanded="true"><div data-tocid="mplab-harmony-smart-energy-library-d3711e11" class="topicref" data-id="mplab-harmony-smart-energy-library" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action mplab-harmony-smart-energy-library-d3711e11-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-81A73CB2-02C0-41CF-9C28-0AECE56FFF26.html" id="mplab-harmony-smart-energy-library-d3711e11-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1</ph>
MPLAB® Harmony Smart Energy Library</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="true"><div data-tocid="driver-libraries-d3711e19" class="topicref" data-id="driver-libraries" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action driver-libraries-d3711e19-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-97853572-2DF9-4BDC-8CC2-427931EE96D9.html" id="driver-libraries-d3711e19-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1</ph>
Driver Libraries</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem" aria-expanded="false"><div data-tocid="plc-phy-driver-d3711e27" class="topicref" data-id="plc-phy-driver" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action plc-phy-driver-d3711e27-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-261B02C6-E685-4C12-8EB7-5E717F054F60.html" id="plc-phy-driver-d3711e27-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.1</ph>
PLC PHY Driver</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="g3-mac-rt-driver-d3711e495" class="topicref" data-id="g3-mac-rt-driver" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action g3-mac-rt-driver-d3711e495-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-A7685FE8-B336-4379-A26B-C821EBD7CD85.html" id="g3-mac-rt-driver-d3711e495-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.2</ph>
G3 MAC RT Driver</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="metrology-driver-d3711e1068" class="topicref" data-id="metrology-driver" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action metrology-driver-d3711e1068-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-2023FB1C-E7E7-4813-9BA3-480FEB57627B.html" id="metrology-driver-d3711e1068-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.3</ph>
Metrology Driver</a></div></div></li><li role="treeitem" aria-expanded="true"><div data-tocid="rf215-driver-d3711e1447" class="topicref" data-id="rf215-driver" data-state="expanded"><span role="button" tabindex="0" aria-labelledby="button-collapse-action rf215-driver-d3711e1447-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-2EE5EBF2-6C99-4D66-9EEC-A0C3C8CD40EF.html" id="rf215-driver-d3711e1447-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4</ph>
RF215 Driver</a></div></div><ul role="group" class="navbar-nav nav-list"><li role="treeitem"><div data-tocid="how-the-library-works-d3711e1455" class="topicref" data-id="how-the-library-works" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-F53E33D9-E512-4FD2-81CB-BA7B21D23E0E.html" id="how-the-library-works-d3711e1455-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4.1</ph>
How the Library Works</a></div></div></li><li role="treeitem" class="active"><div data-tocid="using-the-library-d3711e1463" class="topicref" data-id="using-the-library" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-DC149060-F669-4C6E-AEAA-DD6B4CD8165F.html" id="using-the-library-d3711e1463-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4.2</ph>
Using The Library</a></div></div></li><li role="treeitem"><div data-tocid="configuring-the-library-d3711e1471" class="topicref" data-id="configuring-the-library" data-state="leaf"><span role="button" class="wh-expand-btn"></span><div class="title"><a href="GUID-15C4E6AF-BB4B-4B66-B165-F3B9F3B41EBD.html" id="configuring-the-library-d3711e1471-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4.3</ph>
Configuring The Library</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="library-interface-d3711e1479" class="topicref" data-id="library-interface" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action library-interface-d3711e1479-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-08D44F56-1F5C-4E8F-B224-1488888FCAC9.html" id="library-interface-d3711e1479-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.1.4.4</ph>
Library Interface</a></div></div></li></ul></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="service-libraries-d3711e1875" class="topicref" data-id="service-libraries" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action service-libraries-d3711e1875-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-3DBF4BBC-895F-4E64-901F-C76DB2918FDD.html" id="service-libraries-d3711e1875-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.2</ph>
Service Libraries</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="demo-applications-d3711e3287" class="topicref" data-id="demo-applications" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action demo-applications-d3711e3287-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-2188B5B7-760D-4261-AEB9-DDCD9B01A109.html" id="demo-applications-d3711e3287-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">1.3</ph>
Demo Applications</a></div></div></li></ul></li><li role="treeitem" aria-expanded="false"><div data-tocid="getting-started-with-mplab-harmony-plc-stack-d3711e3783" class="topicref" data-id="getting-started-with-mplab-harmony-plc-stack" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action getting-started-with-mplab-harmony-plc-stack-d3711e3783-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-4183CE78-B659-4918-8651-B77A34D15302.html" id="getting-started-with-mplab-harmony-plc-stack-d3711e3783-link"><ph xmlns="http://www.oxygenxml.com/ns/webhelp/toc">2</ph>
Getting Started with MPLAB® Harmony PLC Stack</a></div></div></li><li role="treeitem" aria-expanded="false"><div data-tocid="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d3711e3888" class="topicref backmatter backmatter_parent" data-id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B" data-state="not-ready"><span role="button" tabindex="0" aria-labelledby="button-expand-action GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d3711e3888-link" class="wh-expand-btn"></span><div class="title"><a href="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B.html" id="GUID-0FB3F908-88EE-45CE-94F5-E97AF9049C9B-d3711e3888-link">Microchip Information</a></div></div></li></ul></div>
		                        
                            </div>
                        </nav>
                    
                    
                    <div class="col-lg-9 col-md-9 col-sm-12" id="wh_topic_body">
                        <button id="wh_close_publication_toc_button" class="close-toc-button d-none" aria-label="Toggle publishing table of content" aria-controls="wh_publication_toc" aria-expanded="true">
                            <span class="close-toc-icon-container">
                                <span class="close-toc-icon"></span>     
                            </span>
                        </button>
                        
                        
                        <div class=" wh_topic_content body "><main role="main"><article role="article" aria-labelledby="ariaid-title1"><h1 class="- topic/title title topictitle1" id="ariaid-title1" style="">1.1.4.2 Using The Library</h1><div class="- topic/body body"><p class="- topic/p p">The RF215 library builds on top of an SPI peripheral library (PLIB) to communicate with the RF215 transceiver, which implements 802.15.4 SUN PHY layeres. However, the underlying use of the SPI port is abstracted to the user, and library provides a modem-like interface with data transmission and reception functions and configuration parameters that can be read/written.</p><p class="- topic/p p">Data service access is done in asynchronous mode, requiring some callbacks to be set in order to let the library to provide communication events to the user.</p><p class="- topic/p p">Management service access is done in synchronous mode, and the get/set functions provide the results as part of the returned/referenced parameters.</p></div><article class="- topic/topic topic nested1" aria-labelledby="ariaid-title2" id="example-application-to-send-data-through-rf-and-wait-for-a-response"><h2 class="- topic/title title topictitle2" id="ariaid-title2" style=""> Example application to send data through RF and wait for a response</h2><div class="- topic/body body"><pre class="+ topic/pre pr-d/codeblock pre codeblock c"><span class="hl-directive">#include</span> <span class="hl-string">"app.h"</span>
<span class="hl-directive">#include</span> <span class="hl-string">"driver/rf215/drv_rf215.h"</span>

<span class="hl-directive">#define</span> <span class="hl-defines">APP_TIME_BTW_MSG_US</span> <span class="hl-number">5000</span>

<strong class="hl-keyword">typedef</strong> <strong class="hl-keyword">enum</strong>
{
    <em class="hl-comment">/* Application's state machine's initial state. */</em>
    APP_STATE_INIT=<span class="hl-number">0</span>,
    APP_STATE_RUNNING,
    APP_PLC_STATE_ERROR,

} APP_STATES;

DRV_RF215_TX_REQUEST_OBJ txReqObj;
DRV_HANDLE rf215Handle;
DRV_RF215_TX_HANDLE rfTxHandle;
APP_STATES appState;
uint32_t txTotalCount, txOkCount, rxOkCount, rxBadFcsCount
uint8_t psduTx[DRV_RF215_MAX_PSDU_LEN];

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> <span class="hl-functions">APP_UpdateTxData</span>()
{
    <em class="hl-comment">/* Update TX data content */</em>
    uint16_t dataLen = txReqObj.psduLen - DRV_RF215_FCS_LEN;
    <strong class="hl-keyword">for</strong> (uint16_t k = <span class="hl-number">0</span>; k &lt; dataLen; k++)
    {
        psduTx[k] = (uint8_t) (k + dataLen);
    }
}

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> APP_TxCfmHandler (
    DRV_RF215_TX_HANDLE txHandle,
    DRV_RF215_TX_CONFIRM_OBJ *cfmObj,
    uintptr_t context)
{
    <strong class="hl-keyword">if</strong> (txHandle != rfTxHandle)
    {
        <strong class="hl-keyword">return</strong>;
    }

    txTotalCount++;
    <strong class="hl-keyword">if</strong> (cfmObj-&gt;txResult == RF215_TX_SUCCESS)
    {
        txOkCount++;
    }

    <strong class="hl-keyword">if</strong> (txReqObj.psduLen &lt; DRV_RF215_MAX_PSDU_LEN)
    {
        txReqObj.psduLen++;
    }
    <strong class="hl-keyword">else</strong>
    {
        txReqObj.psduLen = DRV_RF215_FCS_LEN + <span class="hl-number">1</span>;
    }

    <em class="hl-comment">/* Update TX data */</em>
    APP_UpdateTxData();
}

<strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> <span class="hl-functions">APP_RxIndHandler</span>(DRV_RF215_RX_INDICATION_OBJ* ind, uintptr_t ctxt)
{
    <strong class="hl-keyword">if</strong> (ind-&gt;fcsOk == true)
    {
        DRV_RF215_TX_RESULT txResult;

        <em class="hl-comment">/* Update TX time and send new TX request */</em>
        txReqObj.time = ind-&gt;timeIni + SYS_TIME_USToCount(ind-&gt;ppduDurationUS + APP_TIME_BTW_MSG_US);
        rfTxHandle = DRV_RF215_TxRequest(rf215Handle, &amp;txReqObj, &amp;txResult);

        rxOkCount++;
    }
    <strong class="hl-keyword">else</strong>
    {
        rxBadFcsCount++;
    }
}

<strong class="hl-keyword">void</strong> APP_PLC_Initialize ( <strong class="hl-keyword">void</strong> )
{
    <em class="hl-comment">/* Place the App state machine in its initial state. */</em>
    appState = APP_STATE_INIT;
    rf215Handle = DRV_HANDLE_INVALID;

    <em class="hl-comment">/* Initialize TX request object */</em>
    txReqObj.cancelByRx = false;
    txReqObj.ccaMode = PHY_CCA_MODE_<span class="hl-number">3</span>;
    txReqObj.modScheme = FSK_FEC_OFF;
    txReqObj.txPwrAtt = <span class="hl-number">0</span>;
    txReqObj.psduLen = DRV_RF215_FCS_LEN + <span class="hl-number">1</span>;
    txReqObj.timeMode = TX_TIME_ABSOLUTE;
    txReqObj.time = SYS_TIME_Counter64Get() + SYS_TIME_MSToCount(<span class="hl-number">10</span>);
    txReqObj.psdu = psduTx;

    APP_UpdateTxData();
}

<strong class="hl-keyword">void</strong> APP_PLC_Tasks ( <strong class="hl-keyword">void</strong> )
{   
    <em class="hl-comment">/* Check the application's current state. */</em>
    <strong class="hl-keyword">switch</strong> ( appState )
    {
        <em class="hl-comment">/* Application's initial state. */</em>
        <strong class="hl-keyword">case</strong> APP_STATE_INIT:
        {
            SYS_STATUS rf215Status = DRV_RF215_Status(sysObj.drvRf215);
            <strong class="hl-keyword">if</strong> (rf215Status == SYS_STATUS_READY)
            {
                rf215Handle = DRV_RF215_Open(DRV_RF215_INDEX_<span class="hl-number">0</span>, RF215_TRX_ID_RF09);
                <strong class="hl-keyword">if</strong> (rf215Handle != DRV_HANDLE_INVALID)
                {
                    DRV_RF215_TX_RESULT txResult;

                    DRV_RF215_RxIndCallbackRegister(rf215Handle, APP_RxIndHandler, <span class="hl-number">0</span>);
                    DRV_RF215_TxCfmCallbackRegister(rf215Handle, APP_TxCfmHandler, <span class="hl-number">0</span>);

                    rfTxHandle = DRV_RF215_TxRequest(rf215Handle, &amp;txReqObj, &amp;txResult);

                    appState = APP_STATE_RUNNING;
                }
            }
            <strong class="hl-keyword">else</strong> <strong class="hl-keyword">if</strong> (rf215Status == SYS_STATUS_ERROR)
            {
                appState = APP_STATE_ERROR;
            }

            <strong class="hl-keyword">break</strong>;
        }

        <strong class="hl-keyword">case</strong> APP_STATE_RUNNING:
        {
            <strong class="hl-keyword">break</strong>;
        }

        <strong class="hl-keyword">default</strong>:
        {
            <em class="hl-comment">/* TODO: Handle error in application's state machine. */</em>
            <strong class="hl-keyword">break</strong>;
        }
    }
}
</pre></div></article></article></main></div>
                        
                        
                        
                        
                        
                        
                    </div>
                    
                </div>
            </div>
            
            
            
        </div> 
        <div class="mchp_disclaimer"><p class="mchp_disclaimer_text">The online versions of the documents are provided as a courtesy. Verify all content and data in the device’s PDF documentation found on the device product page.</p></div><footer class="navbar navbar-default wh_footer">
  <div class=" footer-container mx-auto ">
    <div class="footer">
  <div class="mchp-wh-footer">
    <div class="mchp-footer">
      <div class="mchp-footer-tier1">
        <div class="spacer"></div>
        <div class="mchp-footer-container">
          <div class="mchp-footer-links mchp-social-media-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.facebook.com/pages/Microchip-Technology-Inc/20320981741" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Facebook" src="oxygen-webhelp/template/resources/images/201016-corp-facebook.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.linkedin.com/company/microchip-technology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip LinkedIn" src="oxygen-webhelp/template/resources/images/201016-corp-linkedin.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://twitter.com/MicrochipTech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Twitter" src="oxygen-webhelp/template/resources/images/201016-corp-twitter.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.youtube.com/user/MicrochipTechnology" target="_blank">
                  <img class="cmp-image__image" alt="Microchip YouTube" src="oxygen-webhelp/template/resources/images/201016-corp-youtube.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.instagram.com/microchiptechnologyinc/" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Instagram" src="oxygen-webhelp/template/resources/images/201016-corp-instagram.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.weibo.com/microchiptech" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Weibo" src="oxygen-webhelp/template/resources/images/201016-corp-weibo.png"/>
                </a>
              </div>
              <div class="mchp-component-item">
                <a class="cmp-image__link" href="https://www.microchip.com/en-us/about/blog" target="_blank">
                  <img class="cmp-image__image" alt="Microchip Blog" src="oxygen-webhelp/template/resources/images/201016-corp-blog.png"/>
                </a>
              </div>
            </div>
          </div>
          <div class="mchp-footer-links">
            <div class="mchp-component-items">
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://www.microchip.com/about-us/contact-us" class="mchp-link__link">Contact</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information" class="mchp-link__link">Legal</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/privacy-policy" class="mchp-link__link">Privacy Policy</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item ">
                <div class="link">
                  <a href="https://www.microchip.com/en-us/about/legal-information/microchip-cookie-statement" class="mchp-link__link">Cookies</a>
                  <span class="mchp-link__separator">|</span>
                </div>
              </div>
              <div class="mchp-component-item">
                <div class="link">
                  <a href="https://careers.microchip.com/" class="mchp-link__link">Careers</a>
                  <span class="mchp-link__separator"></span>
                </div>
              </div>
            </div>
          </div>
          <div class="mchp-footer-newsletter">
            <div class="cmp-text">
              <p>Stay on the leading edge with our blog</p>
            </div>
            <div class="mchp-button-wrapper">
              <a role="button" href="https://www.microchip.com/en-us/about/blog" class="mchp-button mchp-button-regular solid">
                <span class="mchp-button__span">MicroSolutions</span>
              </a>
            </div>
          </div>
        </div>
        <div class="graphic">
          <img src="oxygen-webhelp/template/resources/images/footer-graphic.png"/>
        </div>
      </div>
      <div class="mchp-footer-tier2">
        <p class="mchp-copyright">© Copyright 1998-2022 Microchip Technology Inc. All rights reserved.</p>
      </div>
    </div>
  </div>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-19"></script>
  <script>
    window.dataLayer = window.dataLayer || [];  
    function gtag(){dataLayer.push(arguments);}  
    gtag('js', new Date());   
    gtag('config', 'UA-2724382-19');
  </script>
</div>
  </div>
</footer>
        
        <div id="go2top" class="d-print-none">
            <span class="oxy-icon oxy-icon-up"></span>
        </div>
        
        <div id="modal_img_large" class="modal">
            <span class="close oxy-icon oxy-icon-remove"></span>
            <div id="modal_img_container"></div>
            <div id="caption"></div>
        </div>
        
        
        
    </body>
</html>